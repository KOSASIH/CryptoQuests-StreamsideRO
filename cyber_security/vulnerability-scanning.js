const { spawn } = require('child_process');

function runVulnerabilityScan(target) {
  return new Promise((resolve, reject) => {
    const vulnerabilityScan = spawn('npx', ['nsp', 'check', target]);

    vulnerabilityScan.stdout.on('data', (data) => {
      console.log(`Vulnerability scan: ${data}`);
    });

    vulnerabilityScan.stderr.on('data', (data) => {
      console.error(`Vulnerability scan error: ${data}`);
    });

    vulnerabilityScan.on('close', (code) => {
      if (code === 0) resolve();
      else reject(new Error(`Vulnerability scan exited with code ${code}`));
    });
  });
}

module.exports = { runVulnerabilityScan };
